////////////////////
Licensed to Cloudera, Inc. under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  Cloudera, Inc. licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
////////////////////

=== Limiting Data Transfer Rate between Source-Sink pairs
Flume has the ability to limit the rate of transfer of data between a source-sink pairs.  
This is achieved using the "choke" sink-decorators.  Each choke decorator (from now we'll simply call it a choke) has to be assigned to a "choke-id".  
Here is an example that uses a choke decorator with choke-id "A" between a source and sink of a node.
----
node: source | { choke("A") => sink };
----

The choke-ids are specific to a physical node, and before using a choke with a certain choke-id on a +node+, one should register the choke-id on the physical 
node containing the +node+.  A choke-id can be registered on a physical node using the +setChokeLimit+ command.  When a choke-id is registered, a rate limit (in KB/sec) has to be assigned to it.  
Here is an example to register a choke-id "A" on a physical node +host+ with a limit 1000 KB/sec.
----
exec setChokeLimit host A 1000
----

NOTE: setChokeLimit can also be used to change the limit associated to a choke-id at the run-time. 

The limit set on the choke-id "A" puts the limit on the rate at which the chokes using choke-id "A" can collectively transfer data.  
For example say there is only one source-sink pair on the physical node +host+ that uses a choke with choke-id "A", 
then rate of data transfer between this source-sink pair is limited to 1000 KB/sec. 

NOTE: We only count the size of the event body between a source-sink pair for the purpose of rate limiting. 

Let us take an example where multiple source-sink pairs are using the chokes between them using the same choke-id.

----
node1: source1 | { choke("A") => sink1 };
node2: source2 | { choke("A") => sink2 };
----
In the above example both +source1-sink1+ and +source2-sink2+ pairs use a chokes having the same choke-id "A", so the total data going across these source-sink pairs collectively will be limited by 1000KB/sec. 
Flume does not guarantee in any way how this limit will be divided between the source-sink pairs, but it does guarantee that neither source-sink pair will starve.

NOTE: If multiple source-sink pairs on the same physical node use chokes having the same choke-id, then there is no guarantee how the rate limit will be divided between these source-sink pairs.